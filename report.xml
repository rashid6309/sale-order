<t t-name="studio_report_document">
        <t t-call="web.html_container" t-att-lang="'es-ES'">
        <t t-foreach="docs" t-as="doc">
            <t t-set="background_color" t-value="'#484F5E' if doc.x_studio_diseo_informe.x_name == 'Social' else '#FFFFFF'"/>
            <t t-set="line_color" t-value="'white' if doc.x_studio_diseo_informe.x_name == 'Social' else '#484F5E'"/>
            <t t-set="text_color" t-value="'white' if doc.x_studio_diseo_informe.x_name == 'Social' else 'black'"/>

            <t t-set="table_header_bg" t-value="'#FFFFFF' if doc.x_studio_diseo_informe.x_name == 'Social' else '#484F5E'"/>
            <t t-set="table_header_text_color" t-value="'#484F5E' if doc.x_studio_diseo_informe.x_name == 'Social' else 'white'"/>
            <t t-set="table_border_color" t-value="'white' if doc.x_studio_diseo_informe.x_name == 'Social' else '#484F5E'"/>
            <t t-set="table_body_text_color" t-value="text_color"/>

            <head>
                <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
                <meta charset="utf-8"/>
                <title>Reporte de Cotización</title>

                <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&amp;display=swap" rel="stylesheet"/>

                <style type="text/css">
                    @page {
                        margin: 0;
                        size: A4;
                        background-color: transparent;
                        -webkit-print-color-adjust: exact;
                        color-adjust: exact;
                    }
                    
                    html, body {
                        margin: 0;
                        padding: 0;
                        width: 100%;
                        height: 100vh;
                        font-family: 'Lato', sans-serif;
                        box-sizing: border-box;
                        -webkit-print-color-adjust: exact;
                        color-adjust: exact;
                    }

                    body {
                        padding: 40px 50px 80px 50px;
                        position: relative;
                    }

                    /* Full page background that works with wkhtmltopdf */
                    .page-background {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        z-index: -1;
                        -webkit-print-color-adjust: exact;
                        color-adjust: exact;
                    }

                    .main-container {
                        position: relative;
                        z-index: 1;
                        min-height: calc(100vh - 120px);
                        width: 100%;
                    }

                    .header-line {
                        height: 1px;
                        width: 100%;
                        display: block;
                        margin-bottom: 20px;
                    }

                    .logo-container {
                        text-align: left;
                        margin-bottom: 30px;
                        display: block;
                    }

                    .logo-container img {
                        display: block;
                        max-width: 250px;
                        max-height: 100px;
                        width: auto;
                        height: auto;
                        object-fit: contain;
                    }

                    .info-block {
                        margin-top: 20px;
                    }
                    .info-block p {
                        font-size: 14px;
                        margin-bottom: 10px;
                    }
                    .info-block strong {
                        font-weight: bold;
                    }

                    /* Fixed table styling for proper page breaks */
                    .cotizacion-table, .optional-elements-table {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 13px;
                        margin-top: 25px;
                        margin-bottom: 20px;
                        page-break-inside: auto;
                    }

                    /* Ensure headers repeat properly */
                    .cotizacion-table thead, .optional-elements-table thead {
                        display: table-header-group;
                    }
                    
                    .cotizacion-table tbody, .optional-elements-table tbody {
                        display: table-row-group;
                    }

                    /* Prevent bad page breaks */
                    .cotizacion-table tr, .optional-elements-table tr {
                        page-break-inside: avoid;
                        page-break-after: auto;
                    }

                    .cotizacion-table th, .optional-elements-table th {
                        padding: 8px;
                        text-align: left;
                        vertical-align: middle;
                        page-break-inside: avoid;
                    }

                    .cotizacion-table td, .optional-elements-table td {
                        padding: 6px;
                        vertical-align: top;
                    }

                    /* Numeric column alignment */
                    .cotizacion-table td:nth-child(2),
                    .cotizacion-table td:nth-child(3),
                    .cotizacion-table td:nth-child(4),
                    .optional-elements-table td:nth-child(2),
                    .optional-elements-table td:nth-child(3),
                    .optional-elements-table td:nth-child(4) {
                        text-align: right;
                    }
                    
                    .cotizacion-table th:nth-child(2),
                    .cotizacion-table th:nth-child(3),
                    .cotizacion-table th:nth-child(4),
                    .optional-elements-table th:nth-child(2),
                    .optional-elements-table th:nth-child(3),
                    .optional-elements-table th:nth-child(4) {
                        text-align: center;
                    }

                    /* Summary table */
                    .resumen-table {
                        width: 40%;
                        margin-top: 20px;
                        margin-left: auto;
                        font-size: 13px;
                        border-collapse: collapse;
                        page-break-inside: avoid;
                    }
                    .resumen-table td {
                        padding: 6px;
                        text-align: right;
                    }

                    /* Fixed footer positioning */
                    .footer-container {
                        position: fixed;
                        bottom: 30px;
                        left: 50px;
                        right: 50px;
                        z-index: 999;
                        height: 25px;
                    }

                    .custom-footer-line {
                        height: 1px;
                        background-color: #80c5d9;
                        width: 100%;
                        display: block;
                    }

                    .footer-text-wrapper {
                        position: relative;
                        width: 100%;
                        height: 15px;
                    }

                    .footer-text-left, .footer-text-right {
                        font-size: 12px;
                        position: absolute;
                        top: 5px;
                    }

                    .footer-text-left {
                        left: 0;
                    }

                    .footer-text-right {
                        right: 0;
                    }

                    /* Prevent orphaned content */
                    .page-section {
                        page-break-inside: avoid;
                    }
                    
                    /* Better spacing for conditions section */
                    .conditions-section {
                        margin-top: 35px;
                        page-break-inside: avoid;
                    }
                </style>
            </head>

            <body>
                <!-- Full page background -->
                <div class="page-background" t-attf-style="background-color: #{background_color};"></div>

                <div class="main-container" t-attf-style="color: #{text_color};">

                    <div class="header-line" t-attf-style="background-color: #{line_color};"/>

                    <div class="logo-container">
                        <t t-if="doc.x_studio_diseo_informe and doc.x_studio_diseo_informe.id">
                            <img t-att-src="doc.env['ir.config_parameter'].sudo().get_param('web.base.url') + '/web/image/x_layout_de_presupuest/%s/x_studio_image' % doc.x_studio_diseo_informe.id" alt="Logo de la empresa"/>
                        </t>
                        <t t-else="">
                            <span style="color: red;">Logo no configurado o diseño inválido.</span>
                        </t>
                    </div>

                    <div class="info-block">
                        <p t-attf-style="color: #{text_color};">
                            <strong>&gt; REF: </strong>
                            <strong>
                                <t t-if="doc.x_studio_nombre_del_evento">
                                    <t t-esc="doc.x_studio_nombre_del_evento.upper()"/>
                                </t>
                            </strong>
                        </p>

                        <p t-attf-style="color: #{text_color};">
                            &gt; CLIENTE:
                            <t t-if="doc.partner_id.ref">
                                <t t-esc="doc.partner_id.ref.upper()"/>
                            </t>
                        </p>

                        <p t-attf-style="color: #{text_color};">
                            - PRESUPUESTO:
                            <t t-if="doc.name">
                                <t t-esc="doc.name.upper()"/>
                            </t>
                        </p>

                        <p t-attf-style="color: #{text_color};">
                            - LUGAR:
                            <t t-if="doc.x_studio_lugar">
                                <t t-esc="doc.x_studio_lugar.x_name.upper()"/>
                            </t>
                        </p>

                        <t t-set="fecha" t-value="doc.x_studio_inicio and (doc.x_studio_inicio - datetime.timedelta(hours=3)).strftime('%d/%m/%Y') or ''"/>
                        <t t-set="hora_inicio" t-value="doc.x_studio_inicio and (doc.x_studio_inicio - datetime.timedelta(hours=3)).strftime('%H:%M') or ''"/>
                        <t t-set="hora_fin" t-value="doc.x_studio_fin and (doc.x_studio_fin - datetime.timedelta(hours=3)).strftime('%H:%M') or ''"/>

                        <p t-attf-style="color: #{text_color};">
                            - FECHA:
                            <t t-esc="fecha"/> |
                            HORARIO:
                            <t t-esc="hora_inicio"/> /
                            <t t-esc="hora_fin"/>
                        </p>

                        <t t-if="doc.x_studio_observaciones">
                            <p t-attf-style="color: #{text_color};">
                                - <t t-esc="doc.x_studio_observaciones"/>
                            </p>
                        </t>
                    </div>

                    <p t-attf-style="font-size: 14px; margin-top: 40px; margin-bottom: 10px; color: #{text_color};">
                        <strong>&gt; COTIZACIÓN BASE</strong>
                    </p>
                    
                    <table class="cotizacion-table" t-attf-style="border: 1px solid #{table_border_color};">
                        <thead>
                            <tr t-attf-style="background-color: #{table_header_bg}; color: #{table_header_text_color};">
                                <th t-attf-style="border: 1px solid #{table_border_color}; width: 50%;">Descripción</th>
                                <th t-attf-style="border: 1px solid #{table_border_color}; width: 14%;">Cantidad</th>
                                <th t-attf-style="border: 1px solid #{table_border_color}; width: 20%;">Precio Unitario</th>
                                <th t-attf-style="border: 1px solid #{table_border_color}; width: 16%;">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="doc.order_line" t-as="line"> 
                                <t t-set="importe_sin_descuento" t-value="line.product_uom_qty * line.price_unit"/>
                                <tr t-attf-style="color: #{table_body_text_color};">
                                    
                                    <!-- Descripción -->
                                    <td t-att-style="'border: 1px solid ' + table_border_color + ';' + ('font-style: italic; font-weight: bold;' if line.display_type == 'line_section' else '')">
                                        <t t-set="name_parts" t-value="line.name.split('\n')"/>
                                        <t t-if="name_parts">
                                            <span t-out="name_parts[0]"/>
                                            <t t-if="len(name_parts) &gt; 1">
                                                <br/>
                                                <em>
                                                    <t t-foreach="name_parts[1:]" t-as="note_line">
                                                        <t t-out="note_line"/><br/>
                                                    </t>
                                                </em>
                                            </t>
                                        </t>
                                    </td>
                            
                                    <!-- Cantidad -->
                                    <td t-att-style="'border: 1px solid ' + table_border_color + ';'">
                                        <t t-if="line.display_type != 'line_section'">
                                            <t t-esc="('%.0f' % line.product_uom_qty)"/>
                                        </t>
                                    </td>
                            
                                    <!-- Precio unitario -->
                                    <td t-att-style="'border: 1px solid ' + table_border_color + ';'">
                                        <t t-if="line.display_type != 'line_section'">
                                            <t t-esc="doc.currency_id.symbol"/>
                                            <t t-esc="'{:,.0f}'.format(doc.currency_id.round(line.price_unit)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </t>
                                    </td>
                            
                                    <!-- Total -->
                                    <td t-att-style="'border: 1px solid ' + table_border_color + ';'">
                                        <t t-if="line.display_type != 'line_section'">
                                            <t t-esc="doc.currency_id.symbol"/>
                                            <t t-esc="'{:,.0f}'.format(doc.currency_id.round(importe_sin_descuento)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                    
                    <t t-set="subtotal_sin_descuento" t-value="sum(line.product_uom_qty * line.price_unit for line in doc.order_line)"/>
                    <t t-set="total_descuento" t-value="sum((line.product_uom_qty * line.price_unit * line.discount / 100) for line in doc.order_line)"/>

                    <table class="resumen-table">
                        <tr>
                            <td t-attf-style="color: #{text_color};"><strong>Subtotal</strong></td>
                            <td t-attf-style="border: 1px solid #{table_border_color}; color: #{text_color};">
                                <strong>
                                    <t t-esc="doc.currency_id.symbol"/> 
                                    <t t-esc="'{:,.2f}'.format(doc.currency_id.round(subtotal_sin_descuento)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                </strong>
                            </td>
                        </tr>
                        <t t-if="total_descuento &gt; 0">
                            <tr>
                                <td t-attf-style="color: #{text_color};"><strong>Descuento</strong></td>
                                <td t-attf-style="border: 1px solid #{table_border_color}; color: #{text_color};">
                                    <strong>
                                        <t t-esc="doc.currency_id.symbol"/>
                                        <t t-esc="'{:,.2f}'.format(doc.currency_id.round(total_descuento)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                    </strong>
                                </td>
                            </tr>
                        </t>
                        <tr>
                            <td t-attf-style="color: #{text_color};">IVA</td>
                            <td t-attf-style="border: 1px solid #{table_border_color}; color: #{text_color};">
                                <t t-esc="doc.currency_id.symbol"/> 
                                <t t-esc="'{:,.2f}'.format(doc.currency_id.round(doc.amount_tax)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                            </td>
                        </tr>
                        <tr>
                            <td t-attf-style="color: #{text_color};"><strong>Total</strong></td>
                            <td t-attf-style="border: 1px solid #{table_border_color}; color: #{text_color};">
                                <strong>
                                    <t t-esc="doc.currency_id.symbol"/> 
                                    <t t-esc="'{:,.2f}'.format(doc.currency_id.round(doc.amount_total)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                </strong>
                            </td>
                        </tr>
                    </table>
                    
                    <t t-if="doc.sale_order_option_ids">
                        <p t-attf-style="font-size: 14px; margin-top: 35px; margin-bottom: 10px; color: #{text_color};">
                            <strong>&gt; ELEMENTOS OPCIONALES</strong>
                        </p>
                        <table class="optional-elements-table" t-attf-style="border: 1px solid #{table_border_color};">
                            <thead>
                                <tr t-attf-style="background-color: #{table_header_bg}; color: #{table_header_text_color};">
                                    <th t-attf-style="border: 1px solid #{table_border_color}; width: 50%;">Descripción</th>
                                    <th t-attf-style="border: 1px solid #{table_border_color}; width: 14%;">Cantidad</th>
                                    <th t-attf-style="border: 1px solid #{table_border_color}; width: 20%;">Precio Unitario</th>
                                    <th t-attf-style="border: 1px solid #{table_border_color}; width: 16%;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.sale_order_option_ids" t-as="option">
                                    <tr t-attf-style="color: #{table_body_text_color};">
                                        <td t-attf-style="border: 1px solid #{table_border_color};">
                                            <t t-esc="option.name"/>
                                        </td>
                                        <td t-attf-style="border: 1px solid #{table_border_color};">
                                            <t t-esc="('%.0f' % option.quantity)"/>
                                        </td>
                                        <td t-attf-style="border: 1px solid #{table_border_color};">
                                            <t t-esc="doc.currency_id.symbol"/>
                                            <t t-esc="'{:,.0f}'.format(doc.currency_id.round(option.price_unit)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </td>
                                        <td t-attf-style="border: 1px solid #{table_border_color};">
                                            <t t-set="option_importe_sin_descuento" t-value="option.quantity * option.price_unit"/>
                                            <t t-esc="doc.currency_id.symbol"/>
                                            <t t-esc="'{:,.0f}'.format(doc.currency_id.round(option_importe_sin_descuento)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>
                    
                    <div class="conditions-section">
                        <p t-attf-style="font-size: 14px; margin-bottom: 10px; color: #{text_color};">
                            <strong>&gt; CONDICIONES GENERALES</strong>
                        </p>
                        <p t-attf-style="font-size: 14px; margin-bottom: 8px; color: #{text_color};">
                            - Forma de pago: <t t-esc="doc.payment_term_id.name"/>
                        </p>
                        <p t-attf-style="font-size: 14px; margin-bottom: 8px; color: #{text_color};">
                            - Presupuesto válido hasta:
                            <t t-if="doc.validity_date">
                                <t t-esc="doc.validity_date.strftime('%d/%m/%Y')"/>
                            </t>
                            <t t-if="not doc.validity_date">
                                sin fecha definida
                            </t>
                        </p>
                    </div>

                    <div class="oe_structure"/>

                </div>

                <div class="footer-container">
                    <div class="custom-footer-line"/>
                    <div class="footer-text-wrapper">
                        <span class="footer-text-left" t-attf-style="color: #{text_color};">lang.uy</span>
                        <span class="footer-text-right" t-attf-style="color: #{text_color};">@somoslang</span>
                    </div>
                </div>
            </body>
        </t>
    </t>
</t>
